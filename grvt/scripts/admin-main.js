"use strict";function executeFunctionByName(e,t){for(var a=[].slice.call(arguments).splice(2),i=e.split("."),l=i.pop(),n=0;n<i.length;n++)t=t[i[n]];return t[l].apply(this,a)}function toggle_slimscroll(e){$("#wrapper").hasClass("enlarged")?($(e).css("overflow","inherit").parent().css("overflow","inherit"),$(e).siblings(".slimScrollBar").css("visibility","hidden")):($(e).css("overflow","hidden").parent().css("overflow","hidden"),$(e).siblings(".slimScrollBar").css("visibility","visible"))}function nifty_modal_alert(e,t,a){var i,l=String.fromCharCode(65+Math.floor(26*Math.random())),n=l+Date.now();return i='<div class="md-modal md-effect-'+e+'" id="'+n+'">',i+='<div class="md-content">',i+="<h3>"+t+"</h3>",i+='<div class="md-modal-body">'+a,i+="</div>",i+="</div>",i+="</div>",$("body").prepend(i),window.setTimeout(function(){$("#"+n).addClass("md-show"),$(".md-overlay,.md-close").click(function(){$("#"+n).removeClass("md-show"),window.setTimeout(function(){$("#"+n).remove()},500)})},100),!1}function blockUI(e){$(e).block({message:'<div class="loading"></div>',css:{border:"none",width:"14px",backgroundColor:"none"},overlayCSS:{backgroundColor:"#999",opacity:.4,cursor:"wait"}})}function unblockUI(e){$(e).unblock()}function toggle_fullscreen(){(document.fullscreenEnabled||document.mozFullScreenEnabled||document.webkitFullscreenEnabled)&&(document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement?exitFullscreen():launchIntoFullscreen(document.documentElement))}function launchIntoFullscreen(e){e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen()}function exitFullscreen(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen()}function updateFieldNames(e){e.each(function(e){$(this).find("input, select").each(function(){var t=$(this),a=t.attr("name"),i=a.replace(/\[(\d)\]/,"["+e+"]");t.attr("name",i),t.hasClass("weight-field")&&t.val(e)})})}function sortableContainer(e,t,a,i,l){e.sortable($.extend({forcePlaceholderSize:!0,forceHelperSize:!0,items:t,handle:a||t,update:i||function(e,t){}}),l||{})}function entityRelations(e,t,a){function i(){var e=$(o.html());e.find(".id-field").val(""),e.find(".related-id-field").val(""),e.hide(),n.append(e),e.slideDown()}var l=e.find(t),n=l.find(".relations-container"),s=l.find(".relation-add-btn"),o=l.find(a);e.on("submit",function(e){updateFieldNames(n.find(".related-entity-container"))}),n.on("click",".relation-weight-handler",function(e){e.preventDefault()}),sortableContainer(n,".related-entity-container",".relation-weight-handler",!1,{axis:"y"}),s.on("click",function(e){e.preventDefault(),i()}),n.on("click",".relation-remove-btn",function(e){e.preventDefault();var t=$(this).closest(".related-entity-container");t.slideUp(),t.find(".removed-field").val(1),t.find("input").removeAttr("required")})}function initGalleryForm(){var e=$(".gallery-form"),t=e.find("div.thumbnails"),a=e.find(".thumbnail").length,i=e.find(".add-gallery-images"),l=e.data("max-images");i.fileupload({dataType:"json",start:function(e,t){i.addClass("loading disabled")},done:function(n,s){var o=s.result;if(e.find("div.thumbnails .thumbnail").length>=l)return void i.hide();for(var d in o){a++;var r=$(o[d].html);r.find("input.image-weight-field").val(a),t.append(r)}i.removeClass("disabled")}}),t.on("click",".delete-image",function(e){e.preventDefault();var t=$(this),a=t.closest(".gallery-image");a.fadeOut(200,function(){a.remove()}),t.data("id")&&$.post("/admin.php/gallery/remove-image",{id:t.data("id")},function(){})}),t.sortable({forcePlaceholderSize:!0,forceHelperSize:!0,items:$(this).data("sortable-item-selector"),update:function(e,a){var i=t.sortable("serialize");t.find(".thumbnail").each(function(e){$(this).find("input.image-weight-field").val(e)}),$.ajax({url:"/admin.php/gallery/sort-image",type:"post",data:i,success:function(e){},error:function(e,t,a){alert("Не удалось отсортировать элементы")}})}}),e.on("submit",function(){e.find(".thumbnails .thumbnail").each(function(e,t){$(this).find(".image-position-field").val(e).attr("name","GalleryImages["+e+"][position]"),$(this).find(".image-title-field").attr("name","GalleryImages["+e+"][title]"),$(this).find(".image-comment-field").attr("name","GalleryImages["+e+"][description]"),$(this).find(".image-url-field").attr("name","GalleryImages["+e+"][url]"),$(this).find(".image-id-field").attr("name","GalleryImages["+e+"][id]")})})}$(function(){function e(e,a){var i=e.find(".croppable-image-target"),l=e.find(".image-container"),n=e.find(".crop-btn"),s=$("<img/>",{src:a.url+"?"+Math.random(),class:"croppable-image"});if(n.data("path",a.url),l.empty().append(s),e.data("croppable")){var o=e.data("options");o.trueSize=[a.width,a.height],e.data("options",o),i.removeClass("hidden").show(),e.removeClass("loading"),t(s,o)}}function t(e,t,a){var i=e.data("jcrop");i&&i.destroy(),t.aspectRatioStrict&&(t.aspectRatio=t.minSize[0]/t.minSize[1]),t.setSelect=[0,0,t.minSize[0],t.minSize[1]],e.imagesLoaded(function(){e.Jcrop(t,function(){e.data("jcrop",this),a&&a()})})}var a=$(".async-image-container");a.length&&(a.each(function(){var e=$(this),i=e.data("options"),l=e.find(".image-container img");e.data("croppable")&&(l.length&&t(l,i),a.closest(".collapse").one("shown.bs.collapse",function(){l.length&&t(l,e.data("options"))}))}),a.find(".async-upload").fileupload({dataType:"json",start:function(e){$(e.target).closest(".async-image-container").addClass("loading")},done:function(t,a){var i=a.result,l=i.files[0],n=$(t.target),s=n.closest(".async-image-container"),o=s.find(".async-upload-error");i.success?(n.removeClass("error"),o.hide(),e(s,l)):(l?o.html(l.error):o.html("При загрузке файла произошла ошибка"),n.addClass("error"),o.removeClass("hidden").show(),s.removeClass("loading"))}}),a.on("click",".crop-btn",function(t){t.preventDefault();var a=$(this),i=a.closest(".async-image-container"),l=i.find(".croppable-image-target img.croppable-image"),n=l.data("jcrop"),s=n?n.tellSelect():null,o=a.attr("href")+"?path="+a.data("path");s&&(i.addClass("loading"),$.post(o,s,function(t){e(i,t)},"json"))}))});var w,h,dw,dh,changeptype=function(){w=$(window).width(),h=$(window).height(),dw=$(document).width(),dh=$(document).height(),!0===modernizr.touch&&$("body").addClass("mobile").removeClass("fixed-left"),$("#wrapper").hasClass("forced")||(w>990?($("body").removeClass("smallscreen").addClass("widescreen"),$("#wrapper").removeClass("enlarged")):($("body").removeClass("widescreen").addClass("smallscreen"),$("#wrapper").addClass("enlarged"),$(".left ul").removeAttr("style")),$("#wrapper").hasClass("enlarged")&&$("body").hasClass("fixed-left")?$("body").removeClass("fixed-left").addClass("fixed-left-void"):!$("#wrapper").hasClass("enlarged")&&$("body").hasClass("fixed-left-void")&&$("body").removeClass("fixed-left-void").addClass("fixed-left")),toggle_slimscroll(".slimscrollleft")};$(function(){FastClick.attach(document.body),$("body").tooltip({selector:"[data-toggle=tooltip]",container:"body"}),$(".open-right").click(function(e){$("#wrapper").toggleClass("open-right-sidebar"),e.stopPropagation(),$("body").trigger("resize")}),$(".open-left").click(function(e){e.stopPropagation(),$("#wrapper").toggleClass("enlarged"),$("#wrapper").addClass("forced"),$("#wrapper").hasClass("enlarged")&&$("body").hasClass("fixed-left")?($("body").removeClass("fixed-left").addClass("fixed-left-void"),$(".language-bar").hide()):!$("#wrapper").hasClass("enlarged")&&$("body").hasClass("fixed-left-void")&&($("body").removeClass("fixed-left-void").addClass("fixed-left"),$(".language-bar").show()),$(".left ul").removeAttr("style"),toggle_slimscroll(".slimscrollleft"),$("body").trigger("resize")}),$("#sidebar-menu a").on("click",function(e){$("#wrapper").hasClass("enlarged")||($(this).parent().hasClass("has_sub")&&e.preventDefault(),$(this).hasClass("subdrop")?$(this).hasClass("subdrop")&&($(this).removeClass("subdrop"),$(this).next("ul").slideUp(350),$(".pull-right i",$(this).parent()).removeClass("fa-angle-up").addClass("fa-angle-down")):($("ul",$(this).parents("ul:first")).slideUp(350),$("a",$(this).parents("ul:first")).removeClass("subdrop"),$("#sidebar-menu .pull-right i").removeClass("fa-angle-up").addClass("fa-angle-down"),$(this).next("ul").slideDown(350),$(this).addClass("subdrop"),$(".pull-right i",$(this).parents(".has_sub:last")).removeClass("fa-angle-down").addClass("fa-angle-up"),$(".pull-right i",$(this).siblings("ul")).removeClass("fa-angle-up").addClass("fa-angle-down")))}),$("#sidebar-menu ul li.has_sub a.active").parents("li:last").children("a:first").addClass("active").trigger("click"),$(".widget-header .widget-close").on("click",function(e){e.preventDefault();var t=$(this).parents(".widget:first");bootbox.confirm("Are you sure to remove this widget?",function(e){!0===e&&(t.addClass("animated bounceOutUp"),window.setTimeout(function(){t.data("is-app")?(t.removeClass("animated bounceOutUp"),t.hasClass("ui-draggable")&&t.find(".widget-popout").click(),t.hide(),$("a[data-app='"+t.attr("id")+"']").addClass("clickable")):t.remove()},300))})}),$(document).on("click",".widget-header .widget-toggle",function(e){e.preventDefault(),$(this).toggleClass("closed").parents(".widget:first").find(".widget-content").slideToggle()}),$(document).on("click",".widget-header .widget-popout",function(e){e.preventDefault();var t=$(this).parents(".widget:first");if(t.hasClass("modal-widget"))$("i",this).removeClass("icon-window").addClass("icon-publish"),t.removeAttr("style").removeClass("modal-widget"),t.find(".widget-maximize,.widget-toggle").removeClass("nevershow"),t.draggable("destroy").resizable("destroy");else{t.removeClass("maximized"),t.find(".widget-maximize,.widget-toggle").addClass("nevershow"),$("i",this).removeClass("icon-publish").addClass("icon-window");var a=t.width(),i=t.height();t.addClass("modal-widget").removeAttr("style").width(a).height(i),$(t).draggable({handle:".widget-header",containment:".content-page"}).css({left:t.position().left-2,top:t.position().top-2}).resizable({minHeight:150,minWidth:200})}window.setTimeout(function(){$("body").trigger("resize")},300)}),$("a[data-app]").each(function(e){var t=$(this).data("app"),a=$(this).data("status");$("#"+t).data("is-app",!0),"inactive"==a&&($("#"+t).hide(),$(this).addClass("clickable"))}),$(document).on("click","a[data-app].clickable",function(e){e.preventDefault(),$(this).removeClass("clickable");var t=$(this).data("app");$("#"+t).show(),$("#"+t+" .widget-popout").click();var a=$("#"+t).offset().top-$(window).scrollTop();$("#"+t).css({left:"10",top:-(a-60)+"px"}).addClass("fadeInDown animated"),window.setTimeout(function(){$("#"+t).removeClass("fadeInDown animated")},300)}),$(document).on("click",".widget",function(){$(this).hasClass("modal-widget")&&($(".modal-widget").css("z-index",5),$(this).css("z-index",6))}),$(document).on("click",".widget .reload",function(e){e.preventDefault();var t=$(this).parents(".widget:first");blockUI(t),window.setTimeout(function(){unblockUI(t)},1e3)}),$(document).on("click",".widget-header .widget-maximize",function(e){return e.preventDefault(),$(this).parents(".widget:first").removeAttr("style").toggleClass("maximized"),$("i",this).toggleClass("icon-resize-full-1").toggleClass("icon-resize-small-1"),$(this).parents(".widget:first").find(".widget-toggle").toggleClass("nevershow"),$("body").trigger("resize"),!1}),$("body").trigger("resize")});var debounce=function(e,t,a){var i,l;return function(){var n=this,s=arguments,o=function(){i=null,a||(l=e.apply(n,s))},d=a&&!i;return clearTimeout(i),i=setTimeout(o,t),d&&(l=e.apply(n,s)),l}},sortableTableFix=function(e,t){return t.children().each(function(){$(this).width($(this).width())}),t};$(function(){$(".gallery-form").length&&initGalleryForm()});